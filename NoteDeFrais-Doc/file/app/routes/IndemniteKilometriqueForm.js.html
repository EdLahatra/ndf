<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">app/routes/IndemniteKilometriqueForm.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/index.js~Index.html">Index</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/DepenseCommuneNavBar.js~DepenseCommuneNavBar.html">DepenseCommuneNavBar</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/NavBar.js~NavBar.html">NavBar</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/datepicker-field-factory.js~DatePicker.html">DatePicker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/datepicker.js~DatePicker.html">DatePicker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/distance.js~Distance.html">Distance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/icon-field-factory.js~IconFieldFactory.html">IconFieldFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/image-field-factory.js~ImageFieldFactory.html">ImageFieldFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/list-edit-with-menu.js~ListEditWithMenu.html">ListEditWithMenu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/list-edit.js~ListEdit.html">ListEdit</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/place-autocomplete.js~PlaceAutocomplete.html">PlaceAutocomplete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/realm-form.js~RealmForm.html">RealmForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/select-field-factory.js~SelectFieldFactory.html">SelectFieldFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/select.js~Select.html">Select</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/textbox-field-factory.js~Textbox.html">Textbox</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/components/valeursAnalytiques-autocomplete.js~PlaceAutocomplete.html">PlaceAutocomplete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Component">Component</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">errors</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ApiServiceAccess">ApiServiceAccess</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">lib</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/lib/Logger.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createIconSet">createIconSet</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">routes</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/CategorieDepenseForm.js~CategorieDepenseForm.html">CategorieDepenseForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/CategorieDepenseListe.js~CategorieDepenseListe.html">CategorieDepenseListe</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/CategorieDepenseSelection.js~CategorieDepenseSelection.html">CategorieDepenseSelection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/Chargement.js~Chargement.html">Chargement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/Connexion.js~Connexion.html">Connexion</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/DepenseCommuneHistoriqueListe.js~DepenseCommuneHistoriqueListe.html">DepenseCommuneHistoriqueListe</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/DepenseCommuneListe.js~DepenseCommuneListe.html">DepenseCommuneListe</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/DepenseForm.js~DepenseCommuneForm.html">DepenseCommuneForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/FichePersonnelleForm.js~FichePersonnelleForm.html">FichePersonnelleForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/IndemniteKilometriqueForm.js~IndemniteKilometriqueForm.html">IndemniteKilometriqueForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/Login.js~Login.html">Login</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/NoteDeFraisListe.js~NoteDeFraisListe.html">NoteDeFraisListe</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/Presentation.js~Presentation.html">Presentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/VehiculeForm.js~VehiculeForm.html">VehiculeForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/routes/VehiculeListe.js~VehiculeListe.html">VehiculeListe</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">schemas</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/AxeAnalytique.js~AxeAnalytique.html">AxeAnalytique</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/BaremeKilometrique.js~BaremeKilometrique.html">BaremeKilometrique</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/CategorieDepense.js~CategorieDepense.html">CategorieDepense</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/CompteSecure.js~CompteSecure.html">CompteSecure</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/Configuration.js~Configuration.html">Configuration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/Depense.js~Depense.html">Depense</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/FichePersonnelle.js~FichePersonnelle.html">FichePersonnelle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/Identifiant.js~Identifiant.html">Identifiant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/IndemniteKilometrique.js~IndemniteKilometrique.html">IndemniteKilometrique</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/Justificatif.js~Justificatif.html">Justificatif</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/KilometreAnnuel.js~KilometreAnnuel.html">KilometreAnnuel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/NoteDeFrais.js~NoteDeFrais.html">NoteDeFrais</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/Regulation.js~Regulation.html">Regulation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/Seuil.js~Seuil.html">Seuil</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/ValeurAnalytique.js~ValeurAnalytique.html">ValeurAnalytique</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/schemas/Vehicule.js~Vehicule.html">Vehicule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TYPES">TYPES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STATUTS">STATUTS</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">services</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/ApiService.js~ApiService.html">ApiService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/AxeAnalytiqueService.js~AxeAnalytiqueService.html">AxeAnalytiqueService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/BaremeKilometriqueService.js~BaremeKilometriqueService.html">BaremeKilometriqueService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/CategorieDepenseService.js~CategorieDepenseService.html">CategorieDepenseService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/CompteSecureService.js~CompteSecureService.html">CompteSecureService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/CompteService.js~CompteService.html">CompteService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/ConfigurationService.js~ConfigurationService.html">ConfigurationService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/DepenseService.js~DepenseService.html">DepenseService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/EntityService.js~EntityService.html">EntityService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/FichePersonnelleService.js~FichePersonnelleService.html">FichePersonnelleService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/IndemniteKilometriqueService.js~IndemniteKilometriqueService.html">IndemniteKilometriqueService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/JustificatifService.js~JustificatifService.html">JustificatifService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/NoteDeFraisService.js~NoteDeFraisService.html">NoteDeFraisService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/RealmService.js~RealmService.html">RealmService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/ValeurAnalytiqueService.js~ValeurAnalytiqueService.html">ValeurAnalytiqueService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/VehiculeService.js~VehiculeService.html">VehiculeService</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">styles</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-style">style</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Style">Style</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">app/routes/IndemniteKilometriqueForm.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

import React, { Component, } from &apos;react&apos;;

import { Alert, } from &apos;react-native&apos;;
import _ from &apos;underscore&apos;;
import { Actions, } from &apos;react-native-router-flux&apos;;

import I18n from &apos;../i18n/translations&apos;;

import CompteSecureService from &apos;../services/CompteSecureService&apos;;
import VehiculeService from &apos;../services/VehiculeService&apos;;
import CompteService from &apos;../services/CompteService&apos;;
import IndemniteKilometriqueService from &apos;../services/IndemniteKilometriqueService&apos;;
import FichePersonnelleService from &apos;../services/FichePersonnelleService&apos;;
import NoteDeFraisService from &apos;../services/NoteDeFraisService&apos;;
import RealmForm from &apos;../components/realm-form&apos;;
import IndemniteKilometrique from &apos;../schemas/IndemniteKilometrique&apos;;
import Distance from &apos;../components/distance&apos;;
import AxeAnalytiqueService from &apos;../services/AxeAnalytiqueService&apos;;
import ValeurAnalytiqueService from &apos;../services/ValeurAnalytiqueService&apos;;

/**
 * Page du formulaire d&apos;indemnit&#xE9; kilom&#xE9;trique
 *
 * @module app/routes/IndemniteKilometriqueForm.js
 * @override app/components/RealmForm
 */
export default class IndemniteKilometriqueForm extends RealmForm {

  /**
   * Initialisation de l&apos;&#xE9;tat du composant.
   * Initialisation de l&apos;ensemble des services utiles pour le chargement des donn&#xE9;es.
   */
  constructor () {
    super();
    /** @type {CompteSecureService} */
    this.compteSecureService = new CompteSecureService();
    /** @type {CompteService} */
    this.compteService = new CompteService();
    /** @type {CompteSecureService} */
    this.IndemniteKilometriqueService = new IndemniteKilometriqueService();
    /** @type {VehiculeService} */
    this.vehiculeService = new VehiculeService();
    /** @type {FichePersonnelleService} */
    this.fichePersonnelleService = new FichePersonnelleService();
    /** @type {NoteDeFraisService} */
    this.noteDeFraisService = new NoteDeFraisService();
    /** @type {AxeAnalytiqueService} */
    this.axeAnalytiqueService = new AxeAnalytiqueService();
    /** @type {ValeurAnalytiqueService} */
    this.valeurAnalytiqueService = new ValeurAnalytiqueService();
  }

  getStateValue (props) {
    const selectedAccount = this.compteSecureService.getSelectedAccount();
    const compte = selectedAccount.compte;

    let indemniteKilometrique = _.clone(this.props.depenseCommune) || {};

    const vehicules = this.vehiculeService.findAllForAccount(compte.id);
    let favori;
    if (vehicules.length === 1) {
      favori = vehicules[0];
    }
    else {
      favori = vehicules.find((vehicule) =&gt; vehicule.favori === true);
    }

    if (favori) {
      indemniteKilometrique.idVehicule = favori.id;
    }

    if (vehicules === null || vehicules.length === 0) {

      Alert.alert(I18n.t(&apos;Alert.warning&apos;), I18n.t(&apos;Alert.shouldAddVehicule&apos;),
          [

            { text: I18n.t(&apos;Alert.cancel&apos;), style: &apos;cancel&apos; },
            { text: I18n.t(&apos;Alert.ok&apos;), onPress: () =&gt; Actions.vehiculeForm({ account: compte }) }
          ]
      )

    }

    if (indemniteKilometrique.valeursAnalytiques) {
      indemniteKilometrique.valeursAnalytiques = _.toArray(indemniteKilometrique.valeursAnalytiques)
                                                  .map((valeur)=&gt; this.valeurAnalytiqueService.find(valeur.id));
    }

    return indemniteKilometrique;
  }

  _onCallApi (inputId, apiId, param) {
    super._onCallApi(inputId, apiId, param);
    if (apiId === &apos;places&apos;) {
      Actions.placeAutocomplete({ input: inputId });
    }
    else if (apiId === &apos;distance-matrix&apos;) {

      const originFieldId = &apos;_depart&apos;;
      const destinationFieldId = &apos;lieu&apos;;
      const origins = this.state.value[originFieldId];
      const destinations = this.state.value[destinationFieldId];

      if (origins &amp;&amp; destinations) {
        Distance.compute(origins, destinations).then((distance)=&gt; {
          const data = param &amp;&amp; typeof param === &apos;function&apos; ? param(distance) : distance;
          Actions.refresh({ distance: { data, input: inputId } });
        }).catch(()=&gt; {

          Alert.alert(I18n.t(&apos;Alert.warning&apos;), I18n.t(&apos;Alert.notFoundPlaces&apos;),
              [
                {
                  text: I18n.t(&apos;Alert.changeOrigins&apos;, { origins }),
                  onPress: () =&gt; this._onCallApi(originFieldId, &apos;places&apos;)
                },
                {
                  text: I18n.t(&apos;Alert.changeDestinations&apos;, { destinations }),
                  onPress: () =&gt; this._onCallApi(destinationFieldId, &apos;places&apos;)
                },
                { text: I18n.t(&apos;Alert.cancel&apos;), style: &apos;cancel&apos; }

              ])

        });
      }
      else if (!!origins === false) {
        Alert.alert(I18n.t(&apos;Alert.warning&apos;), I18n.t(&apos;Alert.addOriginPlace&apos;),
            [
              {
                text: I18n.t(&apos;Alert.useGooglePlaceApi&apos;), onPress: () =&gt; this._onCallApi(originFieldId, &apos;places&apos;)
              },
              {
                text: I18n.t(&apos;Alert.cancel&apos;),
                onPress: () =&gt; this.refs.form.getComponent(originFieldId).refs.input.focus(),
                style: &apos;cancel&apos;
              }
            ]
        )
      }
      else if (!!destinations === false) {
        Alert.alert(I18n.t(&apos;Alert.warning&apos;), I18n.t(&apos;Alert.addDestinationPlace&apos;),
            [
              { text: I18n.t(&apos;Alert.useGooglePlaceApi&apos;), onPress: () =&gt; this._onCallApi(destinationFieldId, &apos;places&apos;) },
              {
                text: I18n.t(&apos;Alert.cancel&apos;),
                onPress: () =&gt; this.refs.form.getComponent(destinationFieldId).refs.input.focus(),
                style: &apos;cancel&apos;
              }
            ]
        )

      }
    }
  }

  componentWillReceiveProps (nextProps) {
    if (nextProps.addCar) {
      const selectedAccount = this.compteSecureService.getSelectedAccount();
      const vehicules = this.vehiculeService.findAllForAccount(selectedAccount.compte.id);
      this.state.value.idVehicule = vehicules[0].id;
    }
    super.componentWillReceiveProps(nextProps);
  }

  getConfig () {

    const selectedAccount = this.compteSecureService.getSelectedAccount();

    const vehicules = this.vehiculeService.findAllForAccount(selectedAccount.compte.id);
    const vehiculesOptions = vehicules.map((vehicule) =&gt; {
      return { value: vehicule.id, text: vehicule.nom }
    });

    if (this.compteSecureService.shouldUseApiService()) {
      const axesAnalytiques = this.axeAnalytiqueService.findAllForAccount(selectedAccount.compte.id);
      this.setState({ axesAnalytiques });
      return {
        schema: IndemniteKilometrique.schema,
        axesAnalytiques,
        idVehicule: vehiculesOptions,
        formType: &apos;secure&apos;
      };
    }
    else {
      return {
        schema: IndemniteKilometrique.schema,
        idVehicule: vehiculesOptions,
        formType: &apos;autonome&apos;
      };
    }

  }

  static getTitle (props) {
    return props.category.nom;
  }

  static compteSecureService = new CompteSecureService();
  static indemniteKilometriqueService = new IndemniteKilometriqueService();
  static noteDeFraisService = new NoteDeFraisService();

  static shouldDelete (props) {
    if (props.depenseCommune) {
      return true;
    }
    return false;
  }

  static delete (depenseCommune, props) {
    const selectedAccount = this.compteSecureService.getSelectedAccount();
    const ndf = this.noteDeFraisService.find(this.noteDeFraisService.findEnCours(selectedAccount.compte));
    this.indemniteKilometriqueService.delete(depenseCommune, ndf);
    this.noteDeFraisService.updateTotal(ndf);
    const noteDeFrais = this.noteDeFraisService.find(ndf.id);
    Actions.pop({ refresh: { noteDeFrais } });
  }

  static save (props, formValues) {
    const selectedAccount = this.compteSecureService.getSelectedAccount();

    const ndf = this.noteDeFraisService.find(this.noteDeFraisService.findEnCours(selectedAccount.compte));

    formValues.valeursAnalytiques = _.filter(formValues.valeursAnalytiques, (valeur) =&gt; valeur.id)
                                     .map((valeur) =&gt; {
                                       return { id: valeur.id }
                                     });
    if (formValues.id) {
      this.indemniteKilometriqueService.update(formValues, ndf);
      this.noteDeFraisService.updateTotal(ndf);
      const noteDeFrais = this.noteDeFraisService.find(ndf.id);
      Actions.pop({ refresh: { noteDeFrais } });
    }
    else {
      this.indemniteKilometriqueService.create(formValues, ndf);
      this.noteDeFraisService.updateTotal(ndf);
      const noteDeFrais = this.noteDeFraisService.find(ndf.id);
      Actions.pop({ popNum: 2, refresh: { noteDeFrais } });
    }

  }

}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
